# 树状数组/线段树优化

前置知识

讲解066 ~ 讲解088 \-  _【必备】阶段动态规划专题，整个专题都需要_

讲解108、讲解109 \-  _树状数组，建议两节课都看，包含树状数组的原理、离散化、维护最大值等内容_

讲解110 \-  _线段树，只需看一节课就能理解本节课对线段树的使用，了解线段树专题看讲解110~讲解115_

动态规划优化专题的讲述顺序

专题1：优化尝试和状态设计\-上，讲解127

专题2：优化尝试和状态设计\-下，讲解128

专题3：倍增优化，讲解129

专题4：单调队列/单调栈优化，讲解130

专题5：树状数组/线段树优化，讲解131，本节

专题6：预处理数组优化，讲解132

以上内容是【扩展】课程阶段，动态规划优化的讲述内容

单调性优化的更多内容，比如斜率优化、四边形不等式优化等，会在【挺难】阶段的视频中讲述

题目1

达标子数组的个数

给定一个长度为n的数组nums，给定两个整数lower和upper

子数组达标的条件是累加和在\[lower\, upper\]范围上

返回nums中有多少个达标子数组

1 <= n <= 10^5    nums\[i\]可能是任意整数    \-10^5 <= lower <= upper <= \+10^5

测试链接 : [https://leetcode\.cn/problems/count\-of\-range\-sum/](https://leetcode.cn/problems/count-of-range-sum/)

解法1：归并分治的解法，需要先掌握讲解022 \- 归并分治

解法2：树状数组 \+ 离散化的解法

解法1和解法2的时间复杂度都为O\(n \* log n\)，但是解法1的常数时间更好，解法2的理解难度更低

题目2

平衡子序列的最大和

给定一个长度为n的数组nums，下面定义平衡子序列

如果下标i和下标j被选进了子序列，i在j的左边

那么必须有nums\[j\] \- nums\[i\] >= j \- i

如果一个子序列中任意的两个下标都满足上面的要求，那子序列就是平衡的

返回nums所有平衡子序列里，最大的累加和是多少

1 <= n <= 10^5

\-10^9 <= nums\[i\] <= \+10^9

测试链接 : [https://leetcode\.cn/problems/maximum\-balanced\-subsequence\-sum/](https://leetcode.cn/problems/maximum-balanced-subsequence-sum/)

题目3

方伯伯的玉米田

给定一个长度为n的数组arr

每次可以选择一个区间\[l\,r\]，区间内的数字都\+1，最多执行k次

返回执行完成后，最长的不下降子序列长度

1 <= n <= 10^4

1 <= arr\[i\] <= 5000

2 <= k <= 500

测试链接 : [https://www\.luogu\.com\.cn/problem/P3287](https://www.luogu.com.cn/problem/P3287)

题目4

最长理想子序列

给定一个长度为n，只由小写字母组成的字符串s，给定一个非负整数k

字符串s可以生成很多子序列，下面给出理想子序列的定义

子序列中任意相邻的两个字符，在字母表中位次的差值绝对值<=k，那么这个子序列就是理想子序列

返回最长理想子序列的长度

1 <= n <= 10^5

0 <= k <= 25

字符串s只由小写字母组成

测试链接 : [https://leetcode\.cn/problems/longest\-ideal\-subsequence/](https://leetcode.cn/problems/longest-ideal-subsequence/)

题目5

划分k段的最大得分

给定一个长度为n的数组，最多可以分成k段不重合的子数组

每个子数组获得的分值为内部不同数字的个数

返回能获得的最大分值

1 <= n <= 35000

1 <= k <= 50

1 <= arr\[i\] <= n

k <= n

测试链接 : https://www\.luogu\.com\.cn/problem/CF833B

测试链接 : [https://codeforces\.com/problemset/problem/833/B](https://codeforces.com/problemset/problem/833/B)

题目6

基站选址

一共有n个村庄排成一排，从左往右依次出现1号、2号、3号\.\.n号村庄

dist\[i\]表示i号村庄到1号村庄的距离，该数组一定有序且无重复值

fix\[i\]表示i号村庄建立基站的安装费用

range\[i\]表示i号村庄的接收范围，任何基站和i号村庄的距离不超过这个数字，i号村庄就能得到服务

warranty\[i\]表示如果i号村庄最终没有得到任何基站的服务，需要给多少赔偿费用

最多可以选择k个村庄安装基站，返回总花费最少是多少，总花费包括安装费用和赔偿费用

1 <= n <= 20000    1 <= k <= 100    k <= n

1 <= dist\[i\]、 range\[i\] <= 10^9

1 <= fix\[i\]、 warranty\[i\] <= 10^4

测试链接 : https://www\.luogu\.com\.cn/problem/P2605

本题实现中有一个部分需要用到，讲解059 \- 链式前向星

