# 树上问题专题4-树的直径

前置知识

讲解059 \- _ 链式前向星建图_

讲解078、讲解079 \-  _树型dp_ ，系统学习动态规划看讲解066~讲解088

讲解118 \-  _专题1：树上倍增和LCA\-上_ ，树上倍增和tarjan解决LCA问题，递归函数改成迭代函数的技巧

树上问题专题讲述顺序

专题1：树上倍增和LCA\-上，讲解118

专题2：树上倍增和LCA\-下，讲解119

专题3：树的重心，讲解120

专题4：树的直径，讲解121，本节

专题5：树上差分，讲解122

专题6：换根dp，讲解123

树的静态点分治、树的动态点分治、树链剖分、基环树dp、启发式合并等内容会在【挺难】阶段讲述

树上距离最远的两个点，形成的路径叫做树的直径

<span style="color:#000000">树的直径两种求法，</span> 课上重点图解

1，两次dfs的方式，适用于边权非负的树

优点：不仅能得到直径的长度，还能得到直径沿途所有点，等等很多信息

缺点：遍历两遍树

注意：也可用两次bfs实现，不过综合大部分教材、题解、模版、讨论贴来看，两次dfs的方式更常见

2，树型dp的方式，适用于所有树

优点：遍历一遍树

缺点：只能得到直径的长度

如果树上的边权都为正，则有如下直径相关的结论：

1，如果有多条直径，那么这些直径一定拥有共同的中间部分，可能是一个公共点或一段公共路径

2，树上任意一点，相隔最远的点的集合，直径的两端点至少有一个在其中

题目1

树的直径模版

给定一棵树，边权可能为负，求直径长度

测试链接 : [https://www\.luogu\.com\.cn/problem/U81904](https://www.luogu.com.cn/problem/U81904)

分别实现  两次dfs的方式  树型dp的方式

题目2

所有直径的公共部分

给定一棵树，边权都为正

打印直径长度、所有直径的公共部分有几条边

测试链接 : https://www\.luogu\.com\.cn/problem/P3304

题目3

造公园

一共n个节点，编号1~n，有m条边连接，边权都是1

所有节点可能形成多个联通区，每个联通区保证是树结构

有两种类型的操作

操作 1 x   : 返回x所在联通区的直径长度

操作 2 x y : 如果x和y已经联通，那么忽略

如果不联通，那么执行联通操作，把x和y各自的区域联通起来

并且要保证联通形成大区域的直径长度最小

测试链接 : [https://www\.luogu\.com\.cn/problem/P2195](https://www.luogu.com.cn/problem/P2195)

注意：

讲解056、讲解057 \- 并查集、集合打标签的技巧，一定要先掌握

题目4

巡逻

一共n个节点，编号1~n，结构是一棵树，每条边都是双向的

警察局在1号点，警车每天从1号点出发，一定要走过树上所有的边，最后回到1号点

现在为了减少经过边的数量，你可以新建k条边，把树上任意两点直接相连

并且每天警车必须经过新建的道路正好一次

计算出最佳的新建道路的方案，返回巡逻走边数量的最小值

测试链接 : https://www\.luogu\.com\.cn/problem/P3629

1 <= n <= 10^5

1 <= k <= 2

题目5

消防

一共n个节点，编号1~n，有n\-1条边连接成一棵树，每条边上有非负权值

给定一个非负整数s，表示可以在树上选择一条长度不超过s的路径

然后在这条路径的点上建立消防站，每个居民可以去往这条路径上的任何消防站

目标：哪怕最远的居民走到消防站的距离也要尽量少

返回最远居民走到消防站的最短距离

测试链接 : https://www\.luogu\.com\.cn/problem/P2491

注意：

讲解054 \- 单调队列维护滑动窗口内的最大值，一定要先掌握

