# 线段树专题3-线段树维护更多类型的信息

前置知识

讲解047 - 一维差分，本节课题目3需要；讲解110 - 线段树原理和代码详解

线段树专题讲述顺序

专题1：线段树原理和代码详解，讲解110

专题2：线段树的离散化、二分搜索、特别修改，讲解111

专题3：线段树维护更多类型的信息，讲解112，本节

专题4：线段树解决区间合并的问题，讲解113

专题5：开点线段树、区间最值和历史最值，讲解114

专题6：线段树与扫描线结合的题目，讲解115

线段树与动态规划结合的内容，后续【扩展】标签下的课程里继续安排

树套树、可持久化线段树、树链剖分等内容，后续【挺难】标签下的课程里会安排

这个系列一定是全网有关线段树最好的教学视频，觉得好帮忙推荐给身边的人！

题目1

开关

现有n盏灯排成一排，从左到右依次编号为1~n，一开始所有的灯都是关着的

操作分两种

操作 0 l r : 改变l~r范围上所有灯的状态，开着的灯关上、关着的灯打开

操作 1 l r : 查询l~r范围上有多少灯是打开的

测试链接 : https://www.luogu.com.cn/problem/P3870

线段树维护的信息：一段范围上打开灯的数量

题目2

贪婪大陆

一共有n个格子，编号1~n，开始时格子上没有地雷，实现两种操作，一共调用m次

操作 1 l r : 在l~r范围的格子上放置一种新型地雷，每次地雷都是新款

操作 2 l r : 查询l~r范围的格子上一共放置过多少款不同的地雷

操作1并不是范围上替换地雷，而是范围上新增新型地雷，注意如下的例子

执行 1 3 6，表示3~6范围上新加一种地雷，假设地雷类型是A

执行 1 3 4，表示3~4范围上又新加一种地雷，和上次的地雷不同，假设地雷类型是B

格子3有两种地雷(A、B)、格子4有两种地雷(A、B)、格子5有一种地雷(A)、格子6有一种地雷(A)

执行 2 4 5，返回2；执行 2 5 6，会返回1

测试链接 : https://www.luogu.com.cn/problem/P2184

线段树维护的信息：不同雷区的左边界数量、右边界数量

只有单点更新，所以不需要建立懒更新机制，也就是不需要有down函数

题目3

无聊的数列

给定一个长度为n的数组arr，实现如下两种操作

操作 1 l r k d : arr[l..r]范围上的数依次加上等差数列，首项k，公差d

操作 2 p       : 查询arr[p]的值

测试链接 : [https://www.luogu.com.cn/problem/P1438](https://www.luogu.com.cn/problem/P1438)

推荐看一下讲解047，一维差分的内容

线段树维护差分数组的累加和

题目4

平均数和方差

给定一个长度为n的数组arr，操作分为三种类型，一共调用m次

操作 1 l r : arr数组中[l, r]范围上每个数字加上v，v为double类型

操作 2 l r : 查询arr数组中[l, r]范围上所有数字的平均数，返回double类型

操作 3 l r : 查询arr数组中[l, r]范围上所有数字的方差，返回double类型

测试链接 : [https://www.luogu.com.cn/problem/P1471](https://www.luogu.com.cn/problem/P1471)

科学计数法的读入，本节课代码Code04_DoubleString

线段树维护多种信息，进行范围增加操作时，多种信息更新关系的整理

关于代码：

本节课代码Code04_MeanVariance1，java实现，空间就是会超出限制

本节课代码Code04_MeanVariance2，C++实现，逻辑完全和java版一致，可以全部通过

