# 单调队列/单调栈优化

前置知识

讲解052、讲解053 \- 单调栈

讲解054、讲解055 \- 单调队列

讲解066 ~ 讲解088 \- 【必备】阶段动态规划专题，整个专题都需要

动态规划优化专题的讲述顺序

专题1：优化尝试和状态设计\-上，讲解127

专题2：优化尝试和状态设计\-下，讲解128

专题3：倍增优化，讲解129

专题4：单调队列/单调栈优化，讲解130，本节

专题5：树状数组/线段树优化，讲解131

专题6：预处理数组优化，讲解132

以上内容是【扩展】课程阶段，动态规划优化的讲述内容

单调性优化的更多内容，比如斜率优化、四边形不等式优化等，会在【挺难】阶段的视频中讲述

题目1

向右跳跃获得最大得分

给定长度为n\+1的数组arr，下标编号0 ~ n，给定正数a、b

一开始在0位置，每次可以选择\[a\,b\]之间的一个整数，作为向右跳跃的距离

每来到一个位置i，可以获得arr\[i\]作为得分，位置一旦大于n就停止

返回能获得的最大得分

1 <= n <= 2 \* 10^5

1 <= a <= b <= n

\-1000 <= arr\[i\] <= \+1000

测试链接 : [https://www\.luogu\.com\.cn/problem/P1725](https://www.luogu.com.cn/problem/P1725)

单调队列优化基础题

其实在讲解075，就讲过多重背包问题的单调队列优化，分析过程比较难，可以学完本节可以去复习一下

题目2

向下收集获得最大能量

有一个n \* m的区域，行和列的编号从1开始

每个能量点用\(i\, j\, v\)表示，i行j列上有价值为v的能量点

一共有k个能量点，并且所有能量点一定在不同的位置

一开始可以在第1行的任意位置，然后每一步必须向下移动

向下去往哪个格子是一个范围，如果当前在\(i\, j\)位置

那么往下可以选择\(i\+1\, j\-t\)\.\.\.\(i\+1\, j\+t\)其中的一个格子

到达最后一行时，收集过程停止，返回能收集到的最大能量价值

1 <= n、m、k、t <= 4000

1 <= v <= 100

测试链接 : [https://www\.luogu\.com\.cn/problem/P3800](https://www.luogu.com.cn/problem/P3800)

单调队列优化基础题

题目3

不超过连续k个元素的最大累加和

给定一个长度为n的数组arr，你可以随意选择数字

要求选择的方案中，连续选择的个数不能超过k个

返回能得到的最大累加和

1 <= n、k <= 10^5

0 <= arr\[i\] <= 10^9

测试链接 : [https://www\.luogu\.com\.cn/problem/P2627](https://www.luogu.com.cn/problem/P2627)

公式加工 \+ 单调队列优化

题目4

粉刷木板的最大收益

一共有n个木板，每个木板长度为1，最多粉刷一次，也可以不刷

一共有m个工人，每个工人用\(li\, pi\, si\)表示：

该工人必须刷连续区域的木板，并且连续的长度不超过li

该工人每刷一块木板可以得到pi的钱

该工人刷的连续区域必须包含si位置的木板

返回所有工人最多能获得多少钱

1 <= n <= 16000

1 <= m <= 100

1 <= pi <= 10000

测试链接 : [http://poj\.org/problem?id=1821](http://poj.org/problem?id=1821)

公式加工 \+ 单调队列优化

题目5

最小移动总距离

所有工厂和机器人都分布在x轴上

给定长度为n的二维数组factory，factory\[i\]\[0\]为i号工厂的位置，factory\[i\]\[1\]为容量

给定长度为m的一维数组robot，robot\[j\]为第j个机器人的位置

每个工厂所在的位置都不同，每个机器人所在的位置都不同，机器人到工厂的距离为位置差的绝对值

所有机器人都是坏的，但是机器人可以去往任何工厂进行修理，但是不能超过某个工厂的容量

测试数据保证所有机器人都可以被维修，返回所有机器人移动的最小总距离

1 <= n、m <= 100

\-10^9 <= factory\[i\]\[0\]、robot\[j\] <= \+10^9

0 <= factory\[i\]\[1\] <= m

测试链接 : [https://leetcode\.cn/problems/minimum\-total\-distance\-traveled/](https://leetcode.cn/problems/minimum-total-distance-traveled/)

公式加工 \+ 单调队列优化

题目6

巫师力量和

题目可以简化为如下的描述

给定一个长度为n的数组arr，下标从0开始

任何一个子数组的指标为，子数组累加和 \* 子数组中最小值

返回arr中所有子数组指标的累加和，答案对1000000007取余

1 <= n <= 10^5

1 <= arr\[i\] <= 10^9

测试链接 : [https://leetcode\.cn/problems/sum\-of\-total\-strength\-of\-wizards/](https://leetcode.cn/problems/sum-of-total-strength-of-wizards/)

推荐先看讲解052，题目3，子数组最小值之和，对本题的理解非常有帮助

公式加工 \+ 单调栈优化

注意，单调栈优化和斜率优化结合非常紧密，【挺难】阶段的课程会进一步讲述

题目7

子数组最大变序和

给定一个长度为n的数组arr，变序和定义如下

数组中每个值都可以减小或者不变，必须把整体变成严格升序的

所有方案中，能得到的最大累加和，叫做数组的变序和

比如\[1\,100\,7\]，变序和14，方案为变成\[1\,6\,7\]

比如\[5\,4\,9\]，变序和16，方案为变成\[3\,4\,9\]

比如\[1\,4\,2\]，变序和3，方案为变成\[0\,1\,2\]

返回arr所有子数组的变序和中，最大的那个

1 <= n、arr\[i\] <= 10^6

来自真实大厂笔试，对数器验证

较难的分析 \+ 单调栈优化

注意，单调栈优化和斜率优化结合非常紧密，【挺难】阶段的课程会进一步讲述

题目8

送箱子到码头的最少行程数

一共有m个码头，编号1 ~ m， 给定长度为n的二维数组boxes

boxes\[i\]\[0\]表示i号箱子要送往的码头，boxes\[i\]\[1\]表示i号箱子重量

有一辆马车，一次最多能装a个箱子并且箱子总重量不能超过b

马车一开始在仓库，可以认为在0位置，马车每开动一次，认为行程\+1

箱子必须按照boxes规定的顺序被放上马车，也必须按照顺序被送往各自的码头

马车上相邻的箱子如果去往同一个码头，那么认为共享同一趟行程

马车可能经过多次送货，每次装货需要回到仓库，认为行程\+1，送完所有的货，最终要回到仓库，行程\+1

返回至少需要几个行程能把所有的货都送完

所有数据的范围 <= 10^5

测试链接 : [https://leetcode\.cn/problems/delivering\-boxes\-from\-storage\-to\-ports/](https://leetcode.cn/problems/delivering-boxes-from-storage-to-ports/)

贪心分析 \+ 窗口优化，只用有限几个变量维护窗口信息，无需单调队列/单调栈

