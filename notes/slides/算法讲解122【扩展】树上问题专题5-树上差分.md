# 树上问题专题5-树上差分

前置知识

讲解059 -  _链式前向星建图_

讲解078、讲解079 - _ 树型dp_            系统学习动态规划看讲解066~讲解088

讲解118 -  _专题1：树上倍增和LCA-上    _ 树上倍增和tarjan算法，递归函数改成迭代函数的技巧

树上问题专题讲述顺序

专题1：树上倍增和LCA-上，讲解118

专题2：树上倍增和LCA-下，讲解119

专题3：树的重心，讲解120

专题4：树的直径，讲解121

专题5：树上差分，讲解122，本节

专题6：换根dp，讲解123

树的静态点分治、树的动态点分治、树链剖分、基环树dp、启发式合并等内容会在【挺难】阶段讲述

树上点差分

解决的问题：每次路径上的修改能不能减少修改代价，最后得到所有修改都生效之后的正确点权

使用树上倍增 或者 tarjan算法，可以快速查询每条路径两端点的最低公共祖先

假设x和y的最低公共祖先为lca，从x到y的路径上把所有点权都增加v，可以进行如下操作：

num[x] += v   num[y] += v   num[lca] -= v   num[lca的父节点] -= v

每次修改操作都这么操作

最后只需要按如下方式遍历树：

dfs(u)

1，当前来到节点u，遍历u的所有子节点，dfs(u的每个子节点)

2，num[u] += num[u所有子节点]

课上重点图解

树上边差分

解决的问题：每次路径上的修改能不能减少修改代价，最后得到所有修改都生效之后的正确边权

使用树上倍增 或者 tarjan算法，可以快速查询每条路径两端点的最低公共祖先

假设x和y的最低公共祖先为lca，从x到y的路径上把所有边权都增加v，可以进行如下操作：

num[x] += v   num[y] += v   num[lca] -= 2*v

每次修改操作都这么操作

最后只需要按如下方式遍历树：

dfs(u)

1，当前来到节点u，遍历u的所有子节点，dfs(u的每个子节点)

2，遍历u的每条边，假设边e从父节点u连向子节点v，令weight[e] += num[v]

3，num[u] += num[u所有子节点]

课上重点图解

题目1

树上点差分模版

有n个节点形成一棵树，一开始所有点权都是0

给定很多操作，每个操作(a,b)表示从a到b路径上所有点的点权增加1

所有操作完成后，返回树上的最大点权

测试链接 : https://www.luogu.com.cn/problem/P3128

题目2

松鼠的新家

有n个节点形成一棵树

给定一个由点编号组成的数组，表示松鼠依次要去往的地点

松鼠每走到一个节点都必须拿一个糖果，否则松鼠就停止前进

松鼠来到最后一个地点时不需要吃糖果

打印每个节点上至少准备多少糖果才能让松鼠依次走完数组里的节点

测试链接 : [https://www.luogu.com.cn/problem/P3258](https://www.luogu.com.cn/problem/P3258)

题目3

最小化旅行的价格总和

有n个节点形成一棵树，每个节点上有点权，再给定很多路径

每条路径有开始点和结束点，路径代价就是从开始点到结束点的点权和

所有路径的代价总和就是旅行的价格总和

你可以选择把某些点的点权减少一半，来降低旅行的价格总和

但是要求选择的点不能相邻

返回旅行的价格总和最少能是多少

测试链接 : [https://leetcode.cn/problems/minimize-the-total-price-of-the-trips/](https://leetcode.cn/problems/minimize-the-total-price-of-the-trips/)

题目4

边差分实战

使图不联通的方法数

有n个节点，给定n-1条老边使其连接成一棵树，再给定m条新边额外加在树上

你可以切断两条边让这个图不联通，切断的两条边必须是一条老边和一条新边

返回方法数

测试链接 : [http://poj.org/problem?id=3417](http://poj.org/problem?id=3417)

题目5

运输计划

有n个节点，给定n-1条边使其连接成一棵树，每条边有正数边权

给定很多运输计划，每个运输计划(a,b)表示从a去往b

每个运输计划的代价就是沿途边权和，运输计划之间完全互不干扰

你只能选择一条边，将其边权变成0

你的目的是让所有运输计划代价的最大值尽量小

返回所有运输计划代价的最大值最小能是多少

测试链接 : [https://www.luogu.com.cn/problem/P2680](https://www.luogu.com.cn/problem/P2680)

讲解051 - 二分答案法，一定要先掌握

