# 树上问题专题2-树上倍增和LCA-下

前置知识

讲解061 \-  _最小生成树Kruskal算法_ ，本节课题目2需要

讲解105 \-  _字符串哈希_ ，本节课题目5需要

讲解118 \-  _专题1：树上倍增和LCA\-上_

树上问题专题讲述顺序

专题1：树上倍增和LCA\-上，讲解118

专题2：树上倍增和LCA\-下，讲解119，本节

专题3：树的重心，讲解120

专题4：树的直径，讲解121

专题5：树上差分，讲解122

专题6：换根dp，讲解123

树的静态点分治、树的动态点分治、树链剖分、基环树dp、启发式合并等内容会在【挺难】阶段讲述

有一个显而易见的结论

如果边的权值为正，假设节点a和节点b的最低公共祖先是节点c

那么

a到b的路径长度 = 头节点到a的长度 \+ 头节点到b的长度 \- \(头节点到c的长度 \* 2\)

题目1、题目3都是关于这个内容的练习题

树上倍增相关问题的代码实现大量照抄模版

_难点在于不同题目会和各种内容相互结合，特别考验分析能力_

题目1

紧急集合

一共有n个节点，编号1 ~ n，一定有n\-1条边连接形成一颗树

从一个点到另一个点的路径上有几条边，就需要耗费几个金币

每条查询\(a\, b\, c\)表示有三个人分别站在a、b、c点上

他们想集合在树上的某个点，并且想花费的金币总数最少

一共有m条查询，打印m个答案

1 <= n <= 5 \* 10^5

1 <= m <= 5 \* 10^5

测试链接 : [https://www\.luogu\.com\.cn/problem/P4281](https://www.luogu.com.cn/problem/P4281)

题目2

货车运输

一共有n座城市，编号1 ~ n

一共有m条双向道路，每条道路\(u\, v\, w\)表示有一条限重为w，从u到v的双向道路

从一点到另一点的路途中，汽车载重不能超过每一条道路的限重

每条查询\(a\, b\)表示从a到b的路线中，汽车允许的最大载重是多少

如果从a到b无法到达，那么认为答案是\-1

一共有q条查询，返回答案数组

1 <= n <= 10^4

1 <= m <= 5 \* 10^4

1 <= q <= 3 \* 10^4

0 <= w <= 10^5

1 <= u\, v\, a\, b <= n

测试链接 : [https://www\.luogu\.com\.cn/problem/P1967](https://www.luogu.com.cn/problem/P1967)

题目3

边权相等的最小修改次数

一棵树有n个节点，编号0 ~ n\-1，每条边\(u\,v\,w\)表示从u到v有一条权重为w的边

一共有m条查询，每条查询\(a\,b\)表示，a到b的最短路径中把所有边变成一种值需要修改几条边

返回每条查询的查询结果

1 <= n <= 10^4

1 <= m <= 2 \* 10^4

0 <= u、v、a、b < n

1 <= w <= 26

测试链接 :

[https://leetcode\.cn/problems/minimum\-edge\-weight\-equilibrium\-queries\-in\-a\-tree/](https://leetcode.cn/problems/minimum-edge-weight-equilibrium-queries-in-a-tree/)

题目4

在传球游戏中最大化函数值

给定一个长度为n的数组receiver和一个整数k

总共有n名玩家，编号0 ~ n\-1，这些玩家在玩一个传球游戏

receiver\[i\]表示编号为i的玩家会传球给下一个人的编号

玩家可以传球给自己，也就是说receiver\[i\]可能等于i

你需要选择一名开始玩家，然后开始传球，球会被传恰好k次

如果选择编号为x的玩家作为开始玩家

函数f\(x\)表示从x玩家开始，k次传球内所有接触过球的玩家编号之和

如果某位玩家多次触球，则累加多次

f\(x\) = x \+ receiver\[x\] \+ receiver\[receiver\[x\]\] \+ \.\.\.

你的任务时选择开始玩家x，目的是最大化f\(x\)，返回函数的最大值

测试链接 :

[https://leetcode\.cn/problems/maximize\-value\-of\-function\-in\-a\-ball\-passing\-game/](https://leetcode.cn/problems/maximize-value-of-function-in-a-ball-passing-game/)

题目5

检查树上两节点间的路径是否是回文

一颗树上有n个节点，编号1~n

给定长度为n的数组parent\, parent\[i\]表示节点i的父节点编号

给定长度为n的数组s\, s\[i\]表示节点i上是什么字符

从节点a到节点b经过节点最少的路，叫做a和b的路径

一共有m条查询，每条查询\(a\,b\)，a和b的路径字符串是否是回文

是回文打印"YES"，不是回文打印"NO"

1 <= n <= 10^5

1 <= m <= 10^5

parent\[1\] = 0，即整棵树的头节点一定是1号节点

每个节点上的字符一定是小写字母a~z

测试链接 : https://ac\.nowcoder\.com/acm/contest/78807/G

